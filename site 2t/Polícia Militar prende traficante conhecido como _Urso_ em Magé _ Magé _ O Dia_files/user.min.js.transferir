window.User={apiUrl:"https://api.odia.com.br/v1/",user:{},init:function(){this.getUser()},isAuthenticated:function(){if(!Boolean(this.user.name))return!1;var now=Date.now()/1e3;return!(this.user.auth.expires_in<=now)||(this.logout(),!1)},getToken:function(){return this.isAuthenticated()?this.user.auth.token_type+" "+this.user.auth.access_token:null},setUser:function(user){var now=Date.now()/1e3;user.auth.expires_in=Math.round(user.auth.expires_in+now-10),user.bookmarks||(user.bookmarks=[]),this.user=user,this.saveUser()},saveUser:function(){localStorage.setItem("user",JSON.stringify(this.user))},getUser:function(){if(this.user.name)return this.user;var data=JSON.parse(localStorage.getItem("user"));return data?(this.user=data,this.user):null},getBookmarks:function(){return this.isAuthenticated()&&this.user.bookmarks||[]},saveBookmark:function(bookmark){this.isAuthenticated()&&$.ajax({method:"POST",url:this.apiUrl+"usuarios/me/bookmarks",crossOrigin:!0,headers:{Authorization:this.getToken()},data:bookmark,dataType:"json"}).done(result=>{this.user.bookmarks.push(result),this.saveUser(),updateHeader(this.getUser()),NOVODIA.UTEIS.renderBookmarkBtn()})},removeBookmark:function(bookmarkId){this.isAuthenticated()&&$.ajax({method:"DELETE",url:this.apiUrl+`usuarios/me/bookmarks/${bookmarkId}`,crossOrigin:!0,headers:{Authorization:this.getToken()}}).done(result=>{this.user.bookmarks=this.user.bookmarks.filter(bookmark=>bookmark.id!==bookmarkId),this.saveUser(),updateHeader(this.getUser()),NOVODIA.UTEIS.renderBookmarkBtn(),$('div[data-content="bookmarks-user-menu"]').removeClass("hidden").addClass("show")})},setTime:function(time){this.isAuthenticated()&&$.ajax({method:"PUT",url:this.apiUrl+"usuarios/me",crossOrigin:!0,headers:{Authorization:this.getToken()},data:{time:time},dataType:"json"}).done(result=>{this.user.time=time,this.saveUser()})},getTime:function(){return this.isAuthenticated()?this.user.time:null},setHoroscopo:function(horoscopo){this.isAuthenticated()&&$.ajax({method:"PUT",url:this.apiUrl+"usuarios/me",crossOrigin:!0,headers:{Authorization:this.getToken()},data:{horoscopo:horoscopo},dataType:"json"}).done(result=>{this.user.horoscopo=horoscopo,this.saveUser()})},getHoroscopo:function(){return this.isAuthenticated()?this.user.horoscopo:null},assinar:function(data,successCallback,failCallback){this.isAuthenticated()?$.ajax({method:"POST",url:this.apiUrl+"usuarios/me/assinar",crossOrigin:!0,headers:{Authorization:this.getToken()},data:data,dataType:"json"}).done(successCallback).fail(failCallback):failCallback("Usuário não encontrado!")},changeStatus:function(status){this.isAuthenticated()&&(this.user.status=status,this.saveUser())},logout:function(){this.user={},localStorage.removeItem("user"),NOVODIA.UTEIS.renderBookmarkBtn(),showTeamNews(),showHoroscope()}};